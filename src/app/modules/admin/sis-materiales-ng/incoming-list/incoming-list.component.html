<div class="sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 sm:overflow-hidden bg-card dark:bg-transparent">

    <mat-drawer-container
        class="flex-auto h-full bg-card dark:bg-transparent"
        (backdropClick)="onBackdropClicked()">

        <!-- Drawer -->
        <mat-drawer
            class="w-full md:w-160 dark:bg-gray-900"
            [mode]="drawerMode"
            [opened]="false"
            [position]="'end'"
            [disableClose]="true"
            #matDrawer>
            <router-outlet></router-outlet>
        </mat-drawer>
        <mat-drawer-content class="flex flex-col">

            <!-- Header -->
            <div class="relative flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between py-8 px-6 md:px-8 border-b">
                <!-- Loader -->
                <divInventory
                    class="absolute inset-x-0 bottom-0"
                    *ngIf="isLoading">
                    <mat-progress-bar [mode]="'indeterminate'"></mat-progress-bar>
                </divInventory>
                <!-- Title -->
                <!--<div class="text-4xl font-extrabold tracking-tight">Incoming</div>-->
                <!-- Actions -->
                <div class="flex shrink-0 items-center mt-6 sm:mt-0 sm:ml-4">
                    <!-- Search -->
                    <mat-form-field
                        class="boby-mat-dense boby-mat-rounded min-w-64"
                        [subscriptSizing]="'dynamic'">
                        <mat-icon
                            class="icon-size-5"
                            matPrefix
                            [svgIcon]="'heroicons_solid:magnifying-glass'"></mat-icon>
                        <input
                            matInput
                            [formControl]="searchInputControl"
                            [autocomplete]="'off'"
                            [placeholder]="'Buscar entrada'">
                    </mat-form-field>
                    <!-- Add item button -->
                    <!--<button
                        class="ml-4"
                        mat-flat-button
                        [color]="'primary'"
                        (click)="createProduct()">
                        <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                        <span class="ml-2 mr-1">Agregar</span>
                    </button>-->
                </div>
            </div>

            <mat-tab-group animationDuration="0ms" (selectedTabChange)="selectedTabChange($event)">
                <mat-tab label="Entradas">
                    <div class="overflow-x-auto">
                        <table mat-table [dataSource]="filteredIncoming" class="mat-elevation-z8"
                               matSort (matSortChange)="sortData($event)" matTableExporter  #exporter="matTableExporter" [hiddenColumns]="[0]">

                            <ng-container *ngFor="let col of cols; let i = index" matColumnDef="{{col.field}}">
                                <mat-header-cell *matHeaderCellDef mat-sort-header class="{{col.class}}">{{col.header}}</mat-header-cell>
                                <mat-cell *matCellDef="let row" class="{{col.width}}"
                                          (click)="redirect(row)" [ngClass]="{ 'text-primary-800 bg-accent-100 dark:text-primary-50 dark:bg-accent-500': row === selectedItem }">
                                    {{['fecha_reg','fecha_mod','fecha_hora_vuelo','fecha_hora_incidente','fecha_hora_recepcion'].includes(col.field) ? (row[col.field] | date:'d/M/yyyy H:mm') : row[col.field] }}
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="accion">
                                <mat-header-cell *matHeaderCellDef aria-label="row actions" class="bg-primary font-bold text-left">
                                    Acciones
                                </mat-header-cell>
                                <mat-cell (click)="selectedItem = row" class="text-left" *matCellDef="let row" [ngClass]="{ 'text-primary-800 bg-accent-100 dark:text-primary-50 dark:bg-accent-500': row === selectedItem }">
                                    <!--<button (click)="execute('show',row.id_recepcion)" class="mr-2">
                                        <mat-icon [matTooltip]="'Ver Detalles Entrada'" class="icon-size-7 text-amber-500 dark:text-amber-400 hover:text-amber-700" svgIcon="heroicons_solid:eye"></mat-icon>
                                    </button>-->
                                    <!--<button (click)="execute('print',row)" class="mr-2">
                                        <mat-icon [matTooltip]="'Imprimir Tickets'" class="icon-size-7 text-amber-500 dark:text-amber-400 hover:text-amber-700" svgIcon="heroicons_outline:printer"></mat-icon>
                                    </button>-->
                                    <button *ngIf="row.json_firma_supervisor == null" (click)="execute('agree',row)" class="mx-2">
                                        <mat-icon [matTooltip]="'Aceptar Entrada'" class="icon-size-7 text-green-500 dark:text-green-400 hover:text-green-700" svgIcon="mat_outline:check_circle"></mat-icon>
                                    </button>
                                    <button *ngIf="row.json_firma_supervisor == null" (click)="execute('decline',row)" class="ml-2">
                                        <mat-icon [matTooltip]="'Rechazar Entrada'" class="icon-size-7 text-red-500 dark:text-red-400  hover:text-red-700" svgIcon="heroicons_outline:x-circle"></mat-icon>
                                    </button>
                                </mat-cell>
                            </ng-container>

                            <mat-header-row class="border border-primary-500" *matHeaderRowDef="displayedColumns; sticky:true"></mat-header-row>
                            <mat-row class="border border-primary-500" *matRowDef="let row; columns: displayedColumns;"></mat-row>
                        </table>
                    </div>
                </mat-tab>
                <mat-tab label="Aprobados">
                    <div class="overflow-x-auto">
                        <table mat-table [dataSource]="filteredIncoming" class="mat-elevation-z8"
                               matSort (matSortChange)="sortData($event)" matTableExporter  #exporter="matTableExporter" [hiddenColumns]="[0]">

                            <ng-container *ngFor="let col of cols; let i = index" matColumnDef="{{col.field}}">
                                <mat-header-cell *matHeaderCellDef mat-sort-header class="{{col.class}}">{{col.header}}</mat-header-cell>
                                <mat-cell *matCellDef="let row" class="{{col.width}}"
                                          (click)="redirect(row)" [ngClass]="{ 'text-primary-800 bg-accent-100 dark:text-primary-50 dark:bg-accent-500': row === selectedItem }">
                                    {{['fecha_reg','fecha_mod','fecha_hora_vuelo','fecha_hora_incidente','fecha_hora_recepcion'].includes(col.field) ? (row[col.field] | date:'d/M/yyyy H:mm') : row[col.field] }}
                                </mat-cell>
                            </ng-container>

                            <ng-container matColumnDef="accion">
                                <mat-header-cell *matHeaderCellDef aria-label="row actions" class="bg-primary font-bold text-left">
                                    Acciones
                                </mat-header-cell>
                                <mat-cell (click)="selectedItem = row" class="text-left" *matCellDef="let row" [ngClass]="{ 'text-primary-800 bg-accent-100 dark:text-primary-50 dark:bg-accent-500': row === selectedItem }">
                                    <!--<button (click)="execute('show',row.id_recepcion)" class="mr-2">
                                        <mat-icon [matTooltip]="'Ver Detalles Entrada'" class="icon-size-7 text-amber-500 dark:text-amber-400 hover:text-amber-700" svgIcon="heroicons_solid:eye"></mat-icon>
                                    </button>-->
                                    <button class="mr-2"
                                            [matMenuTriggerFor]="actionMenu">
                                        <mat-icon [matTooltip]="'Imprimir Tickets'" class="icon-size-7 text-amber-500 dark:text-amber-400 hover:text-amber-700" svgIcon="heroicons_outline:printer"></mat-icon>

                                        <mat-menu #actionMenu>

                                            <button mat-menu-item
                                                    (click)="execute('print_single', row)">
                                                <mat-icon [matTooltip]="'Imprimir Ticket Simple'" class="icon-size-7 text-amber-500 dark:text-amber-400 hover:text-amber-700" svgIcon="heroicons_outline:printer"></mat-icon>
                                                Imp. Simple
                                            </button>

                                            <button mat-menu-item
                                                    (click)="execute('print_block', row)">
                                                <mat-icon [matTooltip]="'Imprimir Tickets Bloque'" class="icon-size-7 text-amber-500 dark:text-amber-400 hover:text-amber-700" svgIcon="heroicons_outline:printer"></mat-icon>
                                                Imp. Bloque
                                            </button>

                                        </mat-menu>
                                    </button>
                                </mat-cell>
                            </ng-container>

                            <mat-header-row class="border border-primary-500" *matHeaderRowDef="displayedColumns; sticky:true"></mat-header-row>
                            <mat-row class="border border-primary-500" *matRowDef="let row; columns: displayedColumns;"></mat-row>
                        </table>
                    </div>
                </mat-tab>
                <mat-tab label="Rechazados">
                    <table mat-table [dataSource]="filteredIncoming" class="min-w-full"
                           matSort (matSortChange)="sortData($event)" matTableExporter  #exporter="matTableExporter" [hiddenColumns]="[0]">

                        <ng-container *ngFor="let col of cols; let i = index" matColumnDef="{{col.field}}">
                            <mat-header-cell *matHeaderCellDef mat-sort-header class="{{col.class}}">{{col.header}}</mat-header-cell>
                            <mat-cell *matCellDef="let row" class="{{col.width}}"
                                      (click)="redirect(row)" [ngClass]="{ 'text-primary-800 bg-accent-100 dark:text-primary-50 dark:bg-accent-500': row === selectedItem }">
                                {{['fecha_reg','fecha_mod','fecha_hora_vuelo','fecha_hora_incidente','fecha_hora_recepcion'].includes(col.field) ? (row[col.field] | date:'d/M/yyyy H:mm') : row[col.field] }}
                            </mat-cell>
                        </ng-container>

                        <ng-container matColumnDef="accion">
                            <mat-header-cell *matHeaderCellDef aria-label="row actions" class="bg-primary font-bold text-left">
                                Acciones
                            </mat-header-cell>
                            <mat-cell (click)="selectedItem = row" class="text-left" *matCellDef="let row" [ngClass]="{ 'text-primary-800 bg-accent-100 dark:text-primary-50 dark:bg-accent-500': row === selectedItem }">
                                <!--<button (click)="execute('show',row.id_recepcion)" class="mr-2">
                                    <mat-icon [matTooltip]="'Ver Detalles Entrada'" class="icon-size-7 text-amber-500 dark:text-amber-400 hover:text-amber-700" svgIcon="heroicons_solid:eye"></mat-icon>
                                </button>-->
                                <!--<button (click)="execute('print',row)" class="mr-2">
                                    <mat-icon [matTooltip]="'Imprimir Tickets'" class="icon-size-7 text-amber-500 dark:text-amber-400 hover:text-amber-700" svgIcon="heroicons_outline:printer"></mat-icon>
                                </button>-->
                            </mat-cell>
                        </ng-container>

                        <mat-header-row class="border border-primary-500" *matHeaderRowDef="displayedColumns; sticky:true"></mat-header-row>
                        <mat-row class="border border-primary-500" *matRowDef="let row; columns: displayedColumns;"></mat-row>
                    </table>
                </mat-tab>
            </mat-tab-group>

            <mat-paginator
                           class="sm:absolute sm:inset-x-0 sm:bottom-0 border-b sm:border-t sm:border-b-0 z-10 bg-gray-50 dark:bg-transparent"
                           [ngClass]="{'pointer-events-none': isLoading}"
                           [length]="totalRows"
                           [pageIndex]="currentPage"
                           [pageSize]="pageSize"
                           [pageSizeOptions]="pageSizeOptions"
                           [showFirstLastButtons]="true"
                           (page)="pageChanged($event)"></mat-paginator>

            <ng-template #noIncoming>
                <div class="p-8 sm:p-16 border-t text-4xl font-semibold tracking-tight text-center">No hay pendientes!</div>
            </ng-template>

        </mat-drawer-content>
    </mat-drawer-container>
</div>
